{% load static %}
<div class="table-responsive">
    <table class="table table-hover table-sm mb-0 align-middle">
        <thead>
            <tr>
                <th scope="col">Unité</th>
                <th scope="col">Locataire</th>
                <th scope="col">Statut</th>
                <th scope="col" class="text-end">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for chambre in chambres %}
            <tr>
                <td>
                    <div class="fw-bold">{{ chambre.immeuble.nom }}</div>
                    <div class="text-muted small">{{ chambre.nom }}</div>
                </td>
                <td>
                    {% with location=chambre.active_location %}
                        {% if location %}
                            <i class="fas fa-user text-gray-400 me-1"></i>
                            {{ location.locataire.get_full_name }}
                        {% else %}
                            <span class="text-muted fst-italic">--</span>
                        {% endif %}
                    {% endwith %}
                </td>
                <td>
                    {% if chambre.active_location %}
                        <span class="badge bg-success-soft text-success">Occupée</span>
                    {% else %}
                        <span class="badge bg-secondary-soft text-secondary">Libre</span>
                    {% endif %}
                </td>
                <td class="text-end">
                    {% with location=chambre.active_location %}
                        {% if location %}
                            <a href="{% url 'gestion:historique_paiement_locataire' location.locataire.id %}" class="btn btn-sm btn-outline-primary" title="Voir l'historique des paiements">
                                <i class="fas fa-history"></i>
                            </a>
                            <a href="{% url 'gestion:historique_paiement_locataire_mois' location.locataire.id today.year today.month %}" class="btn btn-sm btn-outline-info" title="Voir le paiement du mois en cours">
                                <i class="fas fa-calendar-check"></i>
                            </a>
                        {% endif %}
                    {% endwith %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4" class="text-center py-4">
                    <p class="mb-0 text-muted">Aucune unité à afficher pour les filtres sélectionnés.</p>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if page_obj and page_obj.paginator.num_pages > 1 %}
<div class="card-footer bg-light py-2 border-top-0">
    {% include "gestion/partials/_pagination.html" with source="chambres" %}
</div>
{% endif %}