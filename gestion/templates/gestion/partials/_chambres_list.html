{% load static %}
<div class="table-responsive">
    <table class="table table-hover table-sm mb-0 align-middle">
        <thead>
            <tr>
                <th scope="col">Unité</th>
                <th scope="col">Locataire</th>
                <th scope="col">Statut</th>
                <th scope="col" class="text-end">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for chambre in chambres %}
            {% with location=chambre.active_location %}
            <tr>
                <td>
                    {# CORRECTION: Utilisation des bons noms de champs (addresse et designation) #}
                    <div class="fw-bold">{{ chambre.immeuble.addresse }}</div>
                    <div class="text-muted small">{{ chambre.designation }}</div>
                </td>
                <td>
                    {% if location %}
                        <i class="fas fa-user text-gray-400 me-1"></i>
                        <a href="{% url 'gestion:locataire_detail' location.locataire.id %}" class="text-dark text-decoration-none" title="Voir les détails du locataire">
                            {{ location.locataire.get_full_name|default:location.locataire.email }}
                        </a>
                    {% else %}
                        <span class="text-muted fst-italic">--</span>
                    {% endif %}
                </td>
                <td>
                    {% if location %}
                        <span class="badge bg-success-soft text-success">Occupée</span>
                    {% else %}
                        <span class="badge bg-secondary-soft text-secondary">Libre</span>
                    {% endif %}
                </td>
                <td class="text-end">
                    {% if location %}
                        <a href="{% url 'gestion:historique_paiement_locataire' location.locataire.id %}" class="btn btn-sm btn-outline-primary" title="Voir l'historique complet du locataire">
                            <i class="fas fa-history"></i>
                        </a>
                        <a href="{% url 'gestion:historique_paiement_locataire_mois' location.locataire.id today.year today.month %}" class="btn btn-sm btn-outline-info" title="Voir le paiement du mois en cours">
                            <i class="fas fa-calendar-check"></i>
                        </a>
                    {% endif %}
                </td>
            </tr>
            {% endwith %}
            {% empty %}
            <tr>
                <td colspan="4" class="text-center py-4">
                    <p class="mb-0 text-muted">Aucune unité à afficher pour les filtres sélectionnés.</p>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
